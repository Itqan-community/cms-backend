{% extends "admin/base_site.html" %}
{% load i18n admin_urls static admin_modify %}

{% block title %}{{ title }} | {{ site_title|default:_('Django site admin') }}{% endblock %}

{% block breadcrumbs %}
<div class="breadcrumbs">
<a href="{% url 'admin:index' %}">{% trans 'Home' %}</a>
&rsaquo; <a href="{% url 'admin:app_list' app_label='content' %}">Content</a>
&rsaquo; {{ title }}
</div>
{% endblock %}

{% block content %}
<div class="assets-dashboard">
    <h1>🎯 {{ title }}</h1>
    <p class="help">Manage your Quranic assets, distributions, and access controls from this central dashboard.</p>

    <!-- Statistics Overview -->
    <div class="module aligned" style="margin-bottom: 30px;">
        <h2>📊 Assets Overview</h2>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 20px 0;">
            <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; text-align: center; border-left: 4px solid #28a745;">
                <h3 style="margin: 0; color: #28a745; font-size: 2em;">{{ total_assets }}</h3>
                <p style="margin: 5px 0 0 0; color: #666;">Total Assets</p>
            </div>
            <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; text-align: center; border-left: 4px solid #007bff;">
                <h3 style="margin: 0; color: #007bff; font-size: 2em;">{{ published_assets }}</h3>
                <p style="margin: 5px 0 0 0; color: #666;">Published & Live</p>
            </div>
            <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; text-align: center; border-left: 4px solid #ffc107;">
                <h3 style="margin: 0; color: #ffc107; font-size: 2em;">{{ draft_assets }}</h3>
                <p style="margin: 5px 0 0 0; color: #666;">Draft Assets</p>
            </div>
            <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; text-align: center; border-left: 4px solid #dc3545;">
                <h3 style="margin: 0; color: #dc3545; font-size: 2em;">{{ pending_requests }}</h3>
                <p style="margin: 5px 0 0 0; color: #666;">Pending Access Requests</p>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="module aligned" style="margin-bottom: 30px;">
        <h2>⚡ Quick Actions</h2>
        <div style="display: flex; gap: 15px; flex-wrap: wrap; margin: 20px 0;">
            <a href="{% url 'admin:content_resource_add' %}" class="button default" style="padding: 10px 20px;">
                ➕ Add New Asset
            </a>
            <a href="{% url 'admin:content_resource_changelist' %}" class="button" style="padding: 10px 20px;">
                📋 Manage Assets
            </a>
            <a href="{% url 'admin:content_distribution_changelist' %}" class="button" style="padding: 10px 20px;">
                📦 Manage Download Formats
            </a>
            <a href="{% url 'admin:licensing_license_changelist' %}" class="button" style="padding: 10px 20px;">
                📄 Manage Licenses
            </a>
            <a href="{% url 'admin:licensing_accessrequest_changelist' %}" class="button" style="padding: 10px 20px;">
                🔐 Review Access Requests
            </a>
        </div>
    </div>

    <!-- Assets by Category -->
    <div class="module aligned" style="margin-bottom: 30px;">
        <h2>📚 Assets by Category</h2>
        <table style="width: 100%; margin-top: 15px;">
            <thead>
                <tr>
                    <th style="text-align: left; padding: 10px;">Category</th>
                    <th style="text-align: right; padding: 10px;">Count</th>
                </tr>
            </thead>
            <tbody>
                {% for category in assets_by_category %}
                <tr>
                    <td style="padding: 8px;">
                        {% if category.resource_type == "text" %}📜 Mushaf
                        {% elif category.resource_type == "tafsir" %}📖 Tafsir
                        {% elif category.resource_type == "audio" %}🎵 Recitation
                        {% else %}{{ category.resource_type }}
                        {% endif %}
                    </td>
                    <td style="text-align: right; padding: 8px;">{{ category.count }}</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="2" style="padding: 20px; text-align: center; color: #666;">
                        No assets found. <a href="{% url 'admin:content_resource_add' %}">Create your first asset</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Recent Assets -->
    <div class="module aligned" style="margin-bottom: 30px;">
        <h2>🕐 Recent Assets</h2>
        <table style="width: 100%; margin-top: 15px;">
            <thead>
                <tr>
                    <th style="text-align: left; padding: 10px;">Title</th>
                    <th style="text-align: left; padding: 10px;">Category</th>
                    <th style="text-align: left; padding: 10px;">Publisher</th>
                    <th style="text-align: left; padding: 10px;">Status</th>
                    <th style="text-align: left; padding: 10px;">Created</th>
                </tr>
            </thead>
            <tbody>
                {% for asset in recent_assets %}
                <tr>
                    <td style="padding: 8px;">
                        <a href="{% url 'admin:content_resource_change' asset.pk %}">{{ asset.title }}</a>
                    </td>
                    <td style="padding: 8px;">
                        {% if asset.resource_type == "text" %}📜 Mushaf
                        {% elif asset.resource_type == "tafsir" %}📖 Tafsir
                        {% elif asset.resource_type == "audio" %}🎵 Recitation
                        {% else %}{{ asset.resource_type }}
                        {% endif %}
                    </td>
                    <td style="padding: 8px;">{{ asset.publisher.get_full_name }}</td>
                    <td style="padding: 8px;">
                        {% if asset.workflow_status == "published" %}✅ Published
                        {% elif asset.workflow_status == "reviewed" %}👀 Reviewed
                        {% elif asset.workflow_status == "in_review" %}⏳ In Review
                        {% elif asset.workflow_status == "rejected" %}❌ Rejected
                        {% else %}📝 Draft
                        {% endif %}
                    </td>
                    <td style="padding: 8px;">{{ asset.created_at|date:"M d, Y" }}</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="5" style="padding: 20px; text-align: center; color: #666;">
                        No recent assets found.
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Assets Needing Attention -->
    {% if assets_no_license or assets_no_distribution %}
    <div class="module aligned" style="margin-bottom: 30px; border-left: 4px solid #ffc107;">
        <h2>⚠️ Assets Needing Attention</h2>
        <ul style="margin: 15px 0; padding-left: 20px;">
            {% if assets_no_license %}
            <li>
                <strong>{{ assets_no_license }}</strong> asset(s) without licenses - 
                <a href="{% url 'admin:content_resource_changelist' %}?licenses__isnull=True">View and fix</a>
            </li>
            {% endif %}
            {% if assets_no_distribution %}
            <li>
                <strong>{{ assets_no_distribution }}</strong> asset(s) without download formats - 
                <a href="{% url 'admin:content_resource_changelist' %}?distributions__isnull=True">View and fix</a>
            </li>
            {% endif %}
        </ul>
    </div>
    {% endif %}

    <!-- API Information -->
    <div class="module aligned">
        <h2>🔗 API Endpoints</h2>
        <p>Your assets are accessible via these API endpoints:</p>
        <ul style="font-family: monospace; background: #f8f9fa; padding: 15px; border-radius: 5px;">
            <li><strong>GET</strong> /api/v1/assets/ - List all published assets</li>
            <li><strong>GET</strong> /api/v1/assets/{id}/ - Get asset details</li>
            <li><strong>POST</strong> /api/v1/assets/{id}/request-access/ - Request asset access</li>
            <li><strong>GET</strong> /api/v1/assets/{id}/download/ - Download asset file</li>
        </ul>
        <p style="margin-top: 15px;">
            <a href="/api/v1/docs/" target="_blank" class="button">📖 View API Documentation</a>
        </p>
    </div>
</div>

<style>
.assets-dashboard h2 {
    border-bottom: 1px solid #ddd;
    padding-bottom: 10px;
    margin-bottom: 15px;
}

.assets-dashboard table {
    border-collapse: collapse;
}

.assets-dashboard table th,
.assets-dashboard table td {
    border-bottom: 1px solid #eee;
}

.assets-dashboard table thead th {
    background: #f8f9fa;
    font-weight: bold;
}

.assets-dashboard table tbody tr:hover {
    background: #f8f9fa;
}
</style>
{% endblock %}
