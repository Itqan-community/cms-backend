{
  "prompt": "You are an autonomous coding agent completing STORY-2: Email Verification enforcement for Itqan CMS. Block dashboard access until Auth0 email_verified is true and mirror status in Django user profile.",
  "context": {
    "project": "Itqan CMS",
    "feature": "Email Verification",
    "auth_model": "Auth0 Hybrid (Hosted Universal Login)",
    "tech_stack": ["Angular 19", "Django 4.2", "NG-ZORRO"],
    "screens": ["REG-002"],
    "colors": {"primary": "#669B80", "dark": "#22433D"},
    "developer_flow": "docs/screens/Developer Resource Access & Resource Download - Initial Registration Scenario.png"
  },
  "objectives": [
    "Enforce verified email",
    "Sync email_verified flag to Django User model",
    "Display resend-verification UI"
  ],
  "tasks": [
    "Enable Email Verification in Auth0 tenant with Hosted Universal Login",
    "Configure Auth0 Universal Login page to show verification message",
    "Add post-login action to include email_verified in ID token",
    "Build REG-002 screen: verification status page with Itqan branding using NG-ZORRO",
    "On Angular auth callback, if email_verified=false redirect to /verify-email",
    "Expose Django endpoint /api/auth/verification-status/ to poll",
    "Add Django User model field email_verified",
    "Implement resend verification link via Auth0 Management API"
  ],
  "guard_rails": [
    "No dashboard API access until verified",
    "Rate-limit resend links"
  ],
  "acceptance_criteria": [
    "Unverified user sees verification screen",
    "After clicking link, refresh grants dashboard"
  ],
  "definition_of_done": [
    "E2E test automates verify flow",
    "Story marked completed"
  ],
  "out_of_scope": [
    "Password reset",
    "Multi-factor auth"
  ],
  "references": [
    "docs/Itqan_CMS_BRD.md ยง3.1",
    "docs/screens/Developer Resource Access & Resource Download - Initial Registration Scenario.png",
    "Auth0 Email Verification documentation",
    "Screen REG-002: Email verification confirmation page",
    ".cursor/rules/cms.mdc - Developer Flow Documentation section",
    "frontend/src/app/features/auth/email-verification.component.ts - Angular verification component",
    "backend/apps/authentication/ - Django Auth0 integration"
  ]
}