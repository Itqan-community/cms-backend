{% extends "admin/base_site.html" %}
{% load i18n admin_urls static admin_modify %}

{% block title %}Search Configuration | {{ site_title|default:"Django site admin" }}{% endblock %}

{% block branding %}
<h1 id="site-name"><a href="{% url 'admin:index' %}">{{ site_header|default:"Django administration" }}</a></h1>
{% endblock %}

{% block breadcrumbs %}
<div class="breadcrumbs">
    <a href="{% url 'admin:index' %}">Home</a>
    &rsaquo; <a href="{% url 'admin:app_list' app_label='search' %}">Search</a>
    &rsaquo; Search Configuration
</div>
{% endblock %}

{% block content %}
<h1>MeiliSearch Configuration</h1>

<div class="module aligned">
    <h2>System Status</h2>
    <div class="form-row">
        <div>
            <strong>MeiliSearch Status:</strong>
            {% if meilisearch_healthy %}
                <span style="color: green;">‚úì Healthy</span>
                <a href="{% url 'admin:search_health' %}" class="button">Refresh Status</a>
            {% else %}
                <span style="color: red;">‚úó Unavailable</span>
                <a href="{% url 'admin:search_health' %}" class="button">Check Health</a>
            {% endif %}
        </div>
    </div>
</div>

<div class="module aligned">
    <h2>Search Indexes</h2>
    
    {% for index in indexes %}
    <fieldset class="module aligned">
        <h2>{{ index.name|title }} Index</h2>
        
        <div class="form-row">
            <div class="field-box">
                <strong>Status:</strong>
                {% if index.exists %}
                    <span style="color: green;">‚úì Active</span>
                {% else %}
                    <span style="color: orange;">‚ö† Not Created</span>
                {% endif %}
            </div>
        </div>
        
        {% if index.stats %}
        <div class="form-row">
            <div class="field-box">
                <strong>Documents:</strong> {{ index.stats.numberOfDocuments|default:0 }}
            </div>
        </div>
        
        <div class="form-row">
            <div class="field-box">
                <strong>Index Size:</strong> {{ index.stats.databaseSize|filesizeformat|default:"Unknown" }}
            </div>
        </div>
        
        <div class="form-row">
            <div class="field-box">
                <strong>Last Update:</strong> 
                {% if index.stats.updatedAt %}
                    {{ index.stats.updatedAt }}
                {% else %}
                    Never
                {% endif %}
            </div>
        </div>
        {% endif %}
        
        <div class="form-row">
            <div class="field-box">
                <strong>Configuration:</strong>
                <ul style="margin-left: 20px;">
                    <li><strong>Primary Key:</strong> {{ index.config.primary_key }}</li>
                    <li><strong>Searchable Fields:</strong> {{ index.config.searchable_attributes|join:", " }}</li>
                    <li><strong>Filterable Fields:</strong> {{ index.config.filterable_attributes|join:", " }}</li>
                    <li><strong>Sortable Fields:</strong> {{ index.config.sortable_attributes|join:", " }}</li>
                </ul>
            </div>
        </div>
        
        <div class="form-row">
            <div class="field-box">
                <strong>Actions:</strong>
                <a href="{% url 'admin:search_reindex' index.name %}" 
                   class="button" 
                   onclick="return confirm('This will clear and rebuild the entire {{ index.name }} index. Continue?')">
                    üîÑ Reindex All
                </a>
                <a href="{% url 'admin:search_clear' index.name %}" 
                   class="button" 
                   onclick="return confirm('This will delete all documents from the {{ index.name }} index. Continue?')"
                   style="background: #ba2121;">
                    üóëÔ∏è Clear Index
                </a>
            </div>
        </div>
    </fieldset>
    {% endfor %}
</div>

<div class="module aligned">
    <h2>Search Settings</h2>
    
    <div class="form-row">
        <div class="field-box">
            <strong>MeiliSearch URL:</strong> {{ MEILISEARCH_URL|default:"http://localhost:7700" }}
        </div>
    </div>
    
    <div class="form-row">
        <div class="field-box">
            <strong>Timeout:</strong> {{ MEILISEARCH_TIMEOUT|default:30 }} seconds
        </div>
    </div>
    
    <div class="form-row">
        <div class="field-box">
            <strong>Total Indexes:</strong> {{ indexes|length }}
        </div>
    </div>
</div>

<div class="module aligned">
    <h2>Index Management Tips</h2>
    
    <div class="form-row">
        <div class="field-box">
            <ul style="margin-left: 20px; line-height: 1.5;">
                <li><strong>Reindex All:</strong> Rebuilds the entire index from the database. Use when you've changed index configuration or data structure.</li>
                <li><strong>Clear Index:</strong> Removes all documents from the index without deleting the index configuration.</li>
                <li><strong>Automatic Indexing:</strong> Content is automatically indexed when created/updated via Django signals.</li>
                <li><strong>Search Performance:</strong> Larger indexes may take longer to search. Consider filtering by attributes to improve performance.</li>
                <li><strong>Multilingual Support:</strong> Arabic and English content are both indexed and searchable.</li>
            </ul>
        </div>
    </div>
</div>

{% if error %}
<div class="module aligned">
    <h2 style="color: red;">Error</h2>
    <div class="form-row">
        <div class="field-box">
            <span style="color: red;">{{ error }}</span>
        </div>
    </div>
</div>
{% endif %}

<style>
.button {
    display: inline-block;
    padding: 8px 16px;
    margin: 4px 8px 4px 0;
    background: #417690;
    color: white;
    text-decoration: none;
    border-radius: 4px;
    font-size: 13px;
}

.button:hover {
    background: #205067;
    color: white;
}

.form-row .field-box {
    margin-bottom: 10px;
    padding: 10px;
    background: #f8f8f8;
    border-radius: 4px;
}

fieldset.module {
    margin-bottom: 20px;
    border: 1px solid #ddd;
    border-radius: 4px;
    padding: 15px;
}

fieldset.module h2 {
    background: #f5f5f5;
    margin: -15px -15px 15px -15px;
    padding: 10px 15px;
    border-bottom: 1px solid #ddd;
    font-size: 14px;
    font-weight: bold;
}
</style>

{% endblock %}
